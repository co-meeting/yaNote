# yaNote ヘルプガイド

yaNote は、ブラウザ上で直感的に情報を整理・編集できるジグザグ型ノートアプリです。  
このヘルプガイドでは、yaNote v1.2.13.3 の基本操作や各機能の使い方について、実際の動作に基づいて説明します。

---

## 1. 基本操作

### キャンバス操作
- **パン（移動）**  
  右クリック＋ドラッグで、キャンバス全体を移動できます。  
  （※ 大きな作業領域上で、常に中心に「中心ノード」が配置されます）

- **ズームについて**  
  現在のバージョンでは、ズーム機能は実装されていません。  
  ※ 将来的に実装される可能性があります。

---

## 2. ノード操作

### ノードの生成
- **背景上での生成**  
  空白部分を **ダブルクリック** すると、その位置に新しいノードが生成され、即座に編集モードになります。

- **ショートカットでの生成**  
  選択中または編集中のノードの直下に、**Ctrl/Cmd+Enter** を押すと新規ノードが追加されます。  
  ※ 追加位置は、現在選択中のノードの高さに基づいて自動的に調整されるため、複数行のテキストがあっても適切に配置されます。

### ノードの編集
- **編集開始**  
  ノードを **ダブルクリック** するか、選択状態で「e」キーを押すと編集モードに入ります。  
  編集中は背景が薄い黄色に変わり、テキストを直接修正できます。

- **編集終了**  
  編集中に **Enter キーを2回** 連続で押すと、入力内容が確定され、リンク形式に自動変換されます。  
  ※ 入力内容が空の場合、該当ノードは削除されます。

### ブランチ作成（接続線生成）
- **方法**  
  ノード上で **ダブルクリック** した後、2回目のクリック時にマウスボタンを押し続け、約10px以上ドラッグすると、そのノードから接続線（ブランチ）が生成されます。  
  - **既存ノードへの接続**:  
    ドラッグを離した位置が他のノードに重なっていれば、そのノードとの接続が確定されます。  
  - **自由接続**:  
    ドラッグ先が空白の場合は、自由接続線が生成され、後から接続先を変更できます。

### ノードの移動・削除
- **移動**  
  ノードは **左クリック＋ドラッグ** により移動できます。  
  複数選択している場合は、グループとしてまとめて移動され、相対位置が保持されます。

- **削除**  
  選択中のノードは **Backspace** または **Delete** キーで削除され、関連する接続線も同時に削除されます。

### 複数選択
- **Shift＋クリック**  
  すでに選択中のノードに対して Shift キーを押しながら別のノードをクリックすると、複数ノードが選択されます。  
  同じ操作で、既に選択済みのノードの選択解除も可能です。

- **ラバーバンド選択**  
  空白部分で **左クリック＋ドラッグ** すると、矩形（ラバーバンド）が表示され、その領域内や交差するノード・接続線が一括で選択されます。

### ノード種類変更
- **操作方法**  
  画面右上のコントロールパネルにある「ノード種類変更」ボタンをクリックすることで、  
  ノードの種類を **standard, text-only, grey, red, dotted** の間で切り替えることができます。  
  切り替え後、ノードの見た目（背景、枠線、影、文字色）が即座に更新されます。

---

## 3. 接続線操作

### ノード間接続
- **発動方法**  
  対象ノード上で **ダブルクリック** した後、2回目のクリック時にマウスボタンを押したまま、約10px以上ドラッグすると、  
  接続線生成が開始されます。

- **動作の流れ**  
  1. **ドラッグ開始**:  
     - ダブルクリック後、マウスボタンを押しながらドラッグを開始すると、対象ノードの基準点（初回クリック位置）が記録されます。  
  2. **仮のライン表示**:  
     - ドラッグ中は、一時的な点線が表示され、接続線生成中であることが視覚的に示されます。  
  3. **ドラッグ完了**:  
     - **既存ノードがドロップ先の場合**:  
       ドラッグを離した位置が既存ノードに重なっていれば、接続線が生成され、接続先が確定されます。  
     - **空白がドロップ先の場合**:  
       自由接続線として生成され、線の両端は初回クリック位置とマウスアップ時の位置となります。

- **注意点**  
  接続線生成は必ずダブルクリック後のドラッグ操作で発動し、単なる左クリック＋ドラッグでは生成されません。

### 自由接続
- **発動方法**  
  空白部分で **ダブルクリック** もしくは **ダブルクリック＋ドラッグ** を行うと、自由接続の生成が開始されます。

- **動作の流れ**  
  1. **ドラッグ開始**:  
     - 空白部分でダブルクリック後、2回目のクリック時にマウスボタンを押しながらドラッグすると、初回クリック位置が記録されます。  
  2. **仮のライン表示**:  
     - ドラッグ中は、一時的な点線（ダッシュ）が表示され、自由接続生成中であることが示されます。  
  3. **ドラッグ完了**:  
     - **既存ノードがドロップ先の場合**:  
       マウスを離した位置が既存ノードに重なっていれば、接続線が生成され、接続先が確定されます。  
     - **空白がドロップ先の場合**:  
       自由接続線として生成され、端点は初回クリック位置とマウスアップ時の位置となります。  
  4. **短いドラッグの場合**:  
     - ドラッグ距離が約10px未満の場合は、新規ノード生成として扱われ、即座に編集モードに入ります。

- **注意点**  
  自由接続は空白部分でのダブルクリック後のドラッグ操作でのみ発動します。

### 接続線編集
- **ハンドル操作**  
  接続線を左クリックで選択すると、線の両端にハンドルが表示されます。  
  ハンドルを左クリック＋ドラッグすることで、接続線の端点の接続先を変更できます。

- **自動更新**  
  ノードの移動や編集、キャンバスのパン操作により、接続線は自動的に再計算され、常に最新の状態が表示されます。

---

## 4. グループ選択
- **Shift＋クリック**  
  ノードを選択中に Shift キーを押しながら別のノードをクリックすることで、複数ノードの選択や選択解除が可能です。

- **ラバーバンド選択**  
  空白部分で **左クリック＋ドラッグ** すると、矩形（ラバーバンド）が描画され、矩形内または矩形と交差するすべてのノードおよび接続線が一括で選択されます。

---

## 5. キャンバス操作
- **パン**  
  右クリック＋ドラッグでキャンバス全体を移動できます。

---

## 6. Undo／Redo と状態管理
- **自動保存**  
  各操作（ノードや接続線の生成、編集、移動、削除）が完了するたびに、現在の状態が自動保存されます。

- **Undo／Redo**  
  - **Undo**: Ctrl/Cmd+Z により直前の操作を取り消します。  
  - **Redo**: Ctrl/Cmd+Y により取り消された操作が再適用されます。

- **エクスポート／インポート**  
  - **エクスポート**: 現在の状態が JSON 形式でファイル出力され、ファイル名にはタイトルと日時が自動付与されます。  
  - **インポート**: 保存済みの JSON ファイルから状態が復元され、内部履歴に追加されます。

---

## 7. コントロールパネル
- **表示位置**  
  画面右上に常時表示され、ユーザーは各種操作をシンプルに行えます。

- **主な機能**
  - **新規**  
    - 新規ボタンをクリックすると、未保存の変更がある場合に保存確認ダイアログが表示されます。  
      ユーザーが保存済みであることを確認すると、状態がクリアされ、初期状態（「中心ノード」のみ）が生成されます。
  - **保存（エクスポート）**  
    - 現在の状態を JSON ファイルとして出力します。
  - **開く（インポート）**  
    - 開くボタンをクリックすると、未保存の状態がある場合に保存確認ダイアログが表示されます。  
      ユーザーが保存済みであると確認した場合、JSON ファイルを選択し、状態が復元されます。
  - **ノード種類変更**  
    - 選択中またはデフォルトのノードの種類を切り替えます。
  - **線種・線タイプ変更、太字切替**  
    - 接続線およびノードの表示スタイルを変更し、ツールチップで操作結果がフィードバックされます。

---

## 8. PWA対応
- **概要**  
  yaNote は、PWA（プログレッシブウェブアプリ）としての機能を備えており、オフライン環境でも基本機能が利用可能です。

- **主な機能**  
  - **Service Worker の登録**  
    - ブラウザに Service Worker が登録され、主要なリソース（HTML、CSS、JavaScript、アイコンなど）がキャッシュされます。  
  - **オフライン対応**  
    - キャッシュされたリソースにより、インターネット接続が不安定またはオフラインの場合でも yaNote の基本機能を利用できます。  
  - **迅速な更新**  
    - 新バージョンがリリースされた際は、skipWaiting() や clients.claim() により、ユーザーのリロード操作のみで最新バージョンが反映されます。

---

## 9. ユーザー操作まとめ

| **操作**                   | **対象**               | **操作方法**                                                     | **結果**                                               |
| -------------------------- | ---------------------- | ---------------------------------------------------------------- | ------------------------------------------------------ |
| シングルクリック            | ノード                 | 左クリック                                                       | ノードが選択状態になりハイライトされる。ハンドルは表示されない。  |
| シングルクリック            | 接続線                 | 左クリック                                                       | 接続線が選択され、両端にハンドルが表示される。             |
| シングルクリック            | 空白                   | 左クリック                                                       | すべての選択が解除される。                              |
| ダブルクリック               | ノード                 | 2回目のクリック時、マウスを動かさずに離す                             | ノードが編集モードに入り、背景色が薄い黄色に変化する。       |
| ダブルクリック               | 空白                   | 2回目のクリック時、マウスを動かさずに離す                             | その位置に新規ノードが生成され、即座に編集モードに入る。      |
| ダブルクリック＋ドラッグ    | ノード                 | ノード上で2回目のクリック時、マウスボタンを押したまま約10px以上ドラッグ | ノードから新規接続線（ブランチ）が生成される。             |
| ダブルクリック＋ドラッグ    | 空白                   | 空白上で2回目のクリック時、マウスボタンを押したまま約10px以上ドラッグ | 自由接続線が生成される。                                |
| 左クリック＋ドラッグ         | ノード                 | 左クリック＋ドラッグ（一定距離以上）                                | ノードが移動し、接続線はリアルタイムで更新される。           |
| 左クリック＋ドラッグ         | 接続線のハンドル         | 接続線選択時に表示されたハンドル上で左クリック＋ドラッグ         | 接続線の端点が移動し、接続先が変更される。                 |
| 左クリック＋ドラッグ         | 空白                   | 左クリック＋ドラッグ                                               | ラバーバンドが描画され、矩形内のノード・接続線が選択される。      |
| Shift＋クリック             | ノード                 | Shiftキーを押しながらノードをクリック                             | 複数ノードの選択・選択解除が行われる。                     |
| 右クリック＋ドラッグ         | キャンバス             | 右クリック＋ドラッグ                                               | キャンバス全体が移動（パン）される。                    |
| キーボードショートカット      | 全体の操作              | Ctrl/Cmd+Enter, e, Shift+Enter, Ctrl/Cmd+Z, Ctrl/Cmd+Y, Delete        | ノード・接続線の生成、編集確定、Undo／Redo、削除などが実行される。  |

---

## 10. まとめ

yaNote v1.2.13.3 は、ユーザーが直感的に情報を整理・編集できるツールとして、以下の操作を実現しています。

- **ノード操作**:  
  - ノードは、背景上でのダブルクリックや Ctrl/Cmd+Enter ショートカットにより生成され、ダブルクリックまたは「e」キーで編集が可能です。  
  - 編集確定時には、入力内容が自動的にリンク形式に変換され、接続線も再計算されます。  
  - Shift＋クリックやラバーバンド選択により、複数ノードの選択が容易です.

- **接続線操作**:  
  - ノード間接続は、対象ノード上でのダブルクリック＋ドラッグで発動し、ドラッグ先に応じて既存ノードとの接続または自由接続線として生成されます.  
  - 自由接続は、空白部分でのダブルクリック＋ドラッグで生成され、ドラッグ先が既存ノードならそのノードと接続、空白なら自由接続線として生成されます.  
  - 接続線選択時は、両端に表示されるハンドル操作で、端点の接続先を変更できます.

- **キャンバス操作**:  
  - 右クリック＋ドラッグでキャンバス全体のパン操作が可能です.

- **Undo／Redo と状態管理**:  
  - 各操作は自動保存され、Undo／Redo により誤操作の修正が容易です.  
  - 状態は JSON 形式でエクスポート／インポートでき、外部保存・復元が可能です.

- **コントロールパネル**:  
  - 画面右上に常時表示され、ユーザーは新規、保存（エクスポート）、開く（インポート）、ノード種類変更、線種・線タイプ変更、太字切替などの操作をシンプルに実施できます.  
  - 新規および開くボタン押下時は、未保存状態の場合に保存確認ダイアログが表示され、ユーザーに保存済みかの確認を促します.

- **PWA対応**:  
  - yaNote は PWA として動作し、Service Worker により主要なリソースがキャッシュされ、オフライン環境でも基本機能が利用可能です.  
  - 新バージョンがリリースされた際は、迅速な更新が実現されます.

本仕様書は、現行実装に基づきユーザーが実際に利用できる操作方法を明確に記述しています。今後の改善や機能拡張においても、この仕様書を基準として操作性の向上を図ります.

© 2025 yaNote Project
