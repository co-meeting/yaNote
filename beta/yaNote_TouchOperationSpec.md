# yaNote タッチ操作仕様・実装状況 (iPhone/iPad対応)

## 基本操作対応表

以下の表は、マウス操作に対応するタッチ操作の仕様と、現在の実装状況を整理したものです。

| 操作内容 | マウス操作 | タッチ操作 | 現在の対応状況 | 補足 |
|---------|-----------|-----------|--------------|------|
| パン操作 | 右クリック＋ドラッグ | シングルタッチ＋ドラッグ | ⭕ 基本実装済み | キャンバス全体を移動、一部バグあり |
| ノード選択 | 左クリック | タップ | ⭕ 部分対応 | 選択はできるが挙動が安定しない |
| ノード編集 | ダブルクリック | ダブルタップ | ❌ 未対応 | ダブルタップ検出が不完全 |
| ノード生成 | 空白部分をダブルクリック | 空白部分をダブルタップ | ❌ 未対応 | ブラウザのズームと競合する |
| ノード移動 | ノードをドラッグ | 長押し(300ms)してからドラッグ | ❌ 未対応 | 長押し検出の実装が必要 |
| 複数選択 | Shift+クリック | 二本指タップ | ❌ 未対応 | マルチタッチの実装が必要 |
| 選択解除 | 空白部分をクリック | 空白部分をタップ | △ 動作不安定 | パン操作と競合する場合あり |
| ラバーバンド選択 | 空白部分で左クリック＋ドラッグ | 二本指タッチ＋ドラッグ | ❌ 未対応 | マルチタッチの実装が必要 |

## 接続線関連

| 操作内容 | マウス操作 | タッチ操作 | 現在の対応状況 | 補足 |
|---------|-----------|-----------|--------------|------|
| ノード接続／分岐作成 | ノードをダブルクリック＋ドラッグ | ノードをダブルタップ後、すぐにドラッグ | ❌ 未対応 | 10px以上移動で接続線生成モードに |
| 自由接続線の生成 | 空白部分でダブルクリック＋ドラッグ | 空白部分でダブルタップ後、すぐにドラッグ | ❌ 未対応 | 10px以上移動で自由接続線を生成 |
| 接続線の編集 | 接続線をクリックしてハンドルをドラッグ | 接続線をタップしてハンドルをドラッグ | △ 部分対応 | タップ検出はできるがハンドル操作が困難 |

## コントロールパネル操作

| 操作内容 | マウス操作 | タッチ操作 | 現在の対応状況 | 補足 |
|---------|-----------|-----------|--------------|------|
| ボタン操作 | クリック | タップ | ⭕ 対応済み | 通常のタップで操作可能 |
| ツールチップ表示 | ホバー | 長押し(500ms) | ❌ 未対応 | ホバーに相当する長押し実装が必要 |

## 特殊操作・ショートカット

| 操作内容 | マウス/キーボード操作 | タッチ操作 | 現在の対応状況 | 補足 |
|---------|-------------------|-----------|--------------|------|
| Undo | Ctrl/Cmd+Z | 三本指で左スワイプ | ❌ 未対応 | マルチタッチジェスチャーの実装が必要 |
| Redo | Ctrl/Cmd+Y | 三本指で右スワイプ | ❌ 未対応 | マルチタッチジェスチャーの実装が必要 |
| 全選択 | Ctrl/Cmd+A | 四本指タップ | ❌ 未対応 | マルチタッチジェスチャーの実装が必要 |
| 表示位置リセット | 「⊙」ボタン | 二本指でピンチイン後にピンチアウト | ❌ 未対応 | ピンチジェスチャーの検出と制御が必要 |

## 操作の判断基準と現状の課題

1. **タイムアウトによる判定**:
   - タップ: 単発のタッチ（200ms以内）
   - 長押し: 一定時間（300ms以上）同じ位置を押し続ける
   - ダブルタップ: 2回の連続タップ（間隔300ms以内）
   - **現状**: 長押しの検出が未実装、ダブルタップ検出は不完全

2. **ダブルタップ後のドラッグ距離で動作を決定**:
   - 10px未満 → ノードの編集／新規ノード作成
   - 10px以上 → 接続線の生成（ノード接続 or 自由接続線）
   - **現状**: ダブルタップ+ドラッグの連続操作の検出が未実装

3. **パン操作とノード移動の区別**:
   - キャンバスをタッチしてドラッグ → パン移動
   - ノードを長押し後にドラッグ → ノード移動
   - **現状**: パン操作は基本実装済みだが、ノード移動との区別ができていない

## 実装上の考慮事項と現状の技術的課題

1. **ダブルタップのズーム抑制**:
   - iOS/iPadOSではダブルタップによるズームを抑制する必要がある
   - **現状**: 部分的に実装されているが、完全ではない

2. **長押しの視覚的フィードバック**:
   - 長押し中は軽い振動（可能な場合）と視覚的なフィードバックを提供
   - **現状**: 未実装

3. **マルチタッチの管理**:
   - 複数の指によるジェスチャーを正しく認識・区別する処理
   - **現状**: 未実装、現在はシングルタッチのみ対応

4. **タッチとマウス操作の優先順位**:
   - タッチデバイスでもマウス操作が可能な場合の動作の一貫性を確保
   - **現状**: 判別ロジックが不十分

5. **iOS/iPadOSのスクロール抑制**:
   - タッチ操作時にブラウザの標準スクロールを抑制する必要がある
   - **現状**: 部分的に実装されているが、完全ではない

6. **PWA環境でのタッチ操作**:
   - PWAとして起動した場合のタッチ操作の最適化
   - **現状**: PWA環境での特有の問題に対応できていない

7. **初期表示サイズの最適化**:
   - モバイルデバイスでの初期表示サイズを適切に設定
   - **現状**: デバイスに応じた表示サイズの最適化が不十分