# yaNote タッチ操作仕様・実装状況 (iPhone/iPad対応)

## 基本操作対応表

以下の表は、マウス操作に対応するタッチ操作の仕様と、現在の実装状況を整理したものです。

| 操作内容 | マウス操作 | タッチ操作 | 現在の対応状況 | 補足 |
|---------|-----------|-----------|--------------|------|
| パン操作 | 右クリック＋ドラッグ | シングルタッチ＋ドラッグ | ⭕ 基本実装済み | キャンバス全体を移動、一部バグあり |
| ノード選択 | 左クリック | タップ | ⭕ 基本実装済み | 選択時にハイライトを表示 |
| ノード編集 | ダブルクリック | ダブルタップ | ⭕ 基本実装済み | 編集モードに切り替え可能 |
| ノード生成 | 空白部分をダブルクリック | 空白部分をダブルタップ | ⭕ 基本実装済み | その位置に新規ノードを作成 |
| ノード移動 | ノードをドラッグ | 長押し(300ms)してからドラッグ | ⭕ 基本実装済み | 視覚的フィードバック付き |
| 複数選択 | Shift+クリック | 二本指タップ | ❌ 未対応 | マルチタッチの実装が必要 |
| 選択解除 | 空白部分をクリック | 空白部分をタップ | ⭕ 基本実装済み | パン操作との区別を改善 |
| ラバーバンド選択 | 空白部分で左クリック＋ドラッグ | 二本指タッチ＋ドラッグ | ❌ 未対応 | マルチタッチの実装が必要 |

## 接続線関連

| 操作内容 | マウス操作 | タッチ操作 | 現在の対応状況 | 補足 |
|---------|-----------|-----------|--------------|------|
| ノード接続／分岐作成 | ノードをダブルクリック＋ドラッグ | ノードをダブルタップ後、すぐにドラッグ | △ 部分対応 | 実装中、一部環境で動作不安定 |
| 自由接続線の生成 | 空白部分でダブルクリック＋ドラッグ | 空白部分でダブルタップ後、すぐにドラッグ | △ 部分対応 | 実装中、一部環境で動作不安定 |
| 接続線の編集 | 接続線をクリックしてハンドルをドラッグ | 接続線をタップしてハンドルをドラッグ | △ 部分対応 | タップ検出は改善されたがハンドル操作は引き続き改善が必要 |

## コントロールパネル操作

| 操作内容 | マウス操作 | タッチ操作 | 現在の対応状況 | 補足 |
|---------|-----------|-----------|--------------|------|
| ボタン操作 | クリック | タップ | ⭕ 対応済み | 通常のタップで操作可能 |
| ツールチップ表示 | ホバー | 長押し(500ms) | ❌ 未対応 | ホバーに相当する長押し実装が必要 |

## 特殊操作・ショートカット

| 操作内容 | マウス/キーボード操作 | タッチ操作 | 現在の対応状況 | 補足 |
|---------|-------------------|-----------|--------------|------|
| Undo | Ctrl/Cmd+Z | 三本指で左スワイプ | ❌ 未対応 | マルチタッチジェスチャーの実装予定 |
| Redo | Ctrl/Cmd+Y | 三本指で右スワイプ | ❌ 未対応 | マルチタッチジェスチャーの実装予定 |
| 全選択 | Ctrl/Cmd+A | 四本指タップ | ❌ 未対応 | マルチタッチジェスチャーの実装予定 |
| 表示位置リセット | 「⊙」ボタン | 二本指でピンチイン後にピンチアウト | △ 部分対応 | ブラウザのピンチズームと連携中 |

## 操作の判断基準と現状の課題

1. **タイムアウトによる判定**:
   - タップ: 単発のタッチ（200ms以内）
   - 長押し: 一定時間（300ms以上）同じ位置を押し続ける
   - ダブルタップ: 2回の連続タップ（間隔300ms以内）
   - **現状**: 長押し検出機能を実装済み、ダブルタップ検出も改善

2. **ダブルタップ後のドラッグ距離で動作を決定**:
   - 10px未満 → ノードの編集／新規ノード作成
   - 10px以上 → 接続線の生成（ノード接続 or 自由接続線）
   - **現状**: ダブルタップによるノード編集・生成は実装済み、接続線操作は未対応

3. **パン操作とノード移動の区別**:
   - キャンバスをタッチしてドラッグ → パン移動
   - ノードを長押し後にドラッグ → ノード移動
   - **現状**: パン操作とノード移動の区別を実装済み

## 実装上の考慮事項と現状の技術的課題

1. **ダブルタップのズーム抑制**:
   - iOS/iPadOSではダブルタップによるズームを抑制する必要がある
   - **現状**: 実装済み、ダブルタップによるノード編集・生成時にズームを抑制

2. **長押しの視覚的フィードバック**:
   - 長押し中は軽い振動（可能な場合）と視覚的なフィードバックを提供
   - **現状**: 視覚的フィードバック（軽い拡大効果）を実装済み

3. **マルチタッチの管理**:
   - 複数の指によるジェスチャーを正しく認識・区別する処理
   - **現状**: 基本的なシングルタッチ操作は実装済み、マルチタッチ操作は引き続き未対応

4. **タッチとマウス操作の優先順位**:
   - タッチデバイスでもマウス操作が可能な場合の動作の一貫性を確保
   - **現状**: 入力デバイスの判別ロジックを改善

5. **iOS/iPadOSのスクロール抑制**:
   - タッチ操作時にブラウザの標準スクロールを抑制する必要がある
   - **現状**: touch-action プロパティの最適化により改善

6. **PWA環境でのタッチ操作**:
   - PWAとして起動した場合のタッチ操作の最適化
   - **現状**: PWA環境での基本操作は対応済み

7. **初期表示サイズの最適化**:
   - モバイルデバイスでの初期表示サイズを適切に設定
   - **現状**: viewport の initial-scale を調整し改善