# yaNote v1.2.9 詳細動作仕様書

- 本仕様書は、yaNote の動作の詳細について記述しています。  
- ここに記載される内容は、実装されているすべての機能（ノード生成・編集、接続線操作、キャンバス操作、コントロールパネルの各種機能など）を対象とし、追加された新機能も含みます。
- 本仕様書の修正は、必要な箇所のみ更新してください。

---

## 1. 基本要素とキャンバス

### 1.1. 基本要素

- **ノード（情報ブロック）**  
  - ユーザーが作成するテキストブロック。  
  - **4種類の表示モード**：  
    - **standard（標準）**: 白背景、文字色 #404040、枠線あり  
    - **text-only（テキスト専用）**: 背景・枠線・影なし、文字色 #404040  
    - **grey（グレー）**: 背景 #595959、文字色 #FFFFFF、枠線なし  
    - **red（赤）**: 背景 #BF1304、文字色 #FFFFFF、枠線なし  
  - ノードは、太字設定が可能で、複数行テキストの入力にも対応します（Shift+Enter で改行）。
  - 新規作成時のデフォルトは `standard` ですが、コントロールパネルで変更可能です。

- **線（接続線・独立線）**  
  - ノード間の関連性を示すために使用されます。  
  - 線種は、**standard（標準矢印）**、**no-arrow（矢印なし）**、**reverse-arrow（逆矢印）**、**both-arrow（両方向矢印）** の4種類から選択できます。  
  - また、線の表示は実線と点線で切り替え可能です。  
  - v1.2.9 では、すべての接続線および矢印マーカーの色が **#404040** に統一されています。

### 1.2. キャンバス

- キャンバスは、広大な論理座標（例：10000×10000ピクセル）上に全要素を配置する領域です。
- **初期状態**  
  - 論理座標 (5000, 5000) に「中心ノード」が作成され、他は空白状態です。
- キャンバスのパン（移動）やズーム操作により表示領域は変化しますが、各要素の論理座標は保持され、正確な操作が行えます。

---

## 2. コントロールパネル

- **表示位置:**  
  画面右上に固定表示され、常に操作可能です。  
  ※ `position: fixed` により、キャンバスの transform 影響を受けません。

- **主な要素と機能:**

  - **タイトルフィールド**  
    - ノート全体のタイトルを表示・編集します。  
    - 初回は中心ノードの編集完了時に自動反映され、その後はユーザーが直接変更可能です。  
    - 編集中はテキストが左寄せ、確定後は右寄せになり、入力内容に合わせて自動で幅が調整されます。  
    - 空の場合は「無題」として扱われ、エクスポート時のファイル名に反映されます。

  - **太字ボタン（B）**  
    - 選択中のノードのテキストを太字に切り替えます。  
    - 複数選択時は一括で設定変更可能です。  
    - ノード未選択の場合は無効化されます。

  - **ノード種類変更ボタン（◻︎）**  
    - 現在のノード種類（standard, text-only, grey, red）を切り替えます。  
    - ボタン自体は、現在のデフォルトノード種類を色とテキストで表示し、直感的に状態が把握できるようになっています。  
    - 何も選択されていない場合は、新規作成時のデフォルトノード種類が変更されます。

  - **線種変更ボタン（→, —, ←, ↔）**  
    - 選択中の線（またはデフォルト）の線種を、4種類の中からローテーションで切り替えます。

  - **点線／実線切替ボタン（—, ‥）**  
    - 選択中の線の表示スタイルを、実線と点線で切り替えます。  
    - 状態はボタンのシンボルで示され、選択がない場合はデフォルト設定が変更されます。

  - **その他のボタン**  
    - **「新規」**: すべてのノードと線を削除して初期状態に戻す  
    - **「開く」**: 保存済みの JSON ファイルをインポートし、状態を復元する  
    - **「保存」**: 現在の状態を JSON ファイルとしてエクスポートする  
      （ファイル名にはタイトルと日付・時刻が付与されます）

---

## 3. ノードの操作

### 3.1. ノードの生成と編集

- **生成**:  
  キャンバスの空白部分を **ダブルクリック** すると、その位置に新規ノードが生成されます。  
  ノード生成直後は編集モードとなり、テキスト入力が可能です。

- **編集**:  
  ノードを **ダブルクリック** すると編集モードに入り、背景が薄黄色に変化します。  
  - **編集終了**: Enter キー（2回押下またはフォーカス外クリック）で確定します。  
  - **改行**: Shift+Enter で改行が挿入され、ノードの高さが自動調整されます。  
  - 空白の場合はノード削除の対象となります。

- **ノード種類の変更と太字設定**:  
  - コントロールパネルの **◻︎** ボタンで、選択中のノードの種類を切り替えます。  
  - **B** ボタンで太字設定を行い、重要な情報を強調できます。

### 3.2. 複数選択とグループ操作

- **複数選択**:  
  - **Shift + クリック** またはラバーバンド（ドラッグで矩形選択）により、複数のノードや線を選択可能です。
- **グループ移動**:  
  選択した複数の要素は、グループとして一括移動ができます。  
  関連する線も自動的に追従します。

- **一括削除・編集**:  
  複数選択時は、太字やノード種類、線種、線の表示スタイルなどの設定を一括で変更できます。

---

## 4. 線の操作

### 4.1. 線の生成

- **背景上での生成**:  
  キャンバスの空白部分を **ダブルクリック** し、2回目のクリック時にドラッグすると、開始点から新規線が生成されます。

- **ノード上での生成（ブランチ作成）**:  
  ノードを **ダブルクリック** し、2回目のクリックでドラッグすると、そのノードから線が生成されます。

- **接続変更**:  
  線の両端に表示されるハンドルをドラッグすることで、接続先を変更できます。

### 4.2. 線種と線表示スタイルの変更

- **線種の変更**:  
  コントロールパネルの線種変更ボタンをクリックすると、選択中またはデフォルトの線種が「standard」「no-arrow」「reverse-arrow」「both-arrow」の順に切り替わります。

- **線表示スタイルの切替**:  
  コントロールパネルの点線／実線切替ボタンで、線の表示を実線と点線に変更可能です。  
  すべての接続線および矢印マーカーは、v1.2.9 では **#404040** の色に統一されています。

---

## 5. キャンバス操作

- **パン移動**:  
  - 右クリック＋ドラッグによりキャンバス全体が移動します。  
  - マウスホイールで縦方向、Shift + マウスホイールで横方向に移動できます。  
  - トラックパッドでは二本指スクロールで任意方向に移動可能です。

- **Undo/Redo**:  
  すべての操作（生成、編集、移動、削除など）は Undo/Redo の対象です。  
  - Undo: **Ctrl+Z / Cmd+Z**  
  - Redo: **Ctrl+Y / Cmd+Y**

---

## 6. 状態管理

- **自動保存**:  
  各操作終了時に、ノード、線、各種設定、キャンバスのパン・ズーム状態がローカルストレージに自動保存されます。

- **データのエクスポート／インポート**:  
  - **エクスポート**: 現在の状態を JSON 形式でファイルとして保存。ファイル名にはタイトルと日付・時刻が付与されます。  
  - **インポート**: 保存済み JSON ファイルからデータを復元します。  
  - 古いバージョンのデータも自動マイグレーションされます。

- **多タブ同期**:  
  複数タブ間で状態が更新された場合、最新状態が自動的に同期されます。

---

## 7. マウス操作一覧

| 操作の種類               | 対象      | 開始条件                                                | 結果                                                     |
|------------------------|---------|-------------------------------------------------------|--------------------------------------------------------|
| クリック（シングル）        | ノード     | 左クリック                                               | ノードを選択                                             |
| クリック（シングル）        | 線       | 左クリック                                               | 線を選択（ハンドルが表示）                                |
| クリック（シングル）        | 空白     | 左クリック                                               | 選択解除                                                |
| ダブルクリック            | ノード     | ノードをダブルクリック                                        | 編集モードに入り、テキスト編集が可能                        |
| ダブルクリック            | 空白     | 空白をダブルクリック                                          | 新規ノードが生成される                                      |
| ダブルクリック → ドラッグ  | ノード     | ノードダブルクリック後、一定距離以上ドラッグ（約10px以上）           | ブランチ作成モードで、ノードから線が生成される                  |
| ダブルクリック → ドラッグ  | 空白     | 空白ダブルクリック後、一定距離以上ドラッグ                          | 新規線が生成される                                          |
| ドラッグ（単一）         | ノード     | 左クリック＋ドラッグ（一定距離以上）                                | ノードが移動                                             |
| ドラッグ（単一）         | 線の端点   | 左クリック＋ドラッグ                                           | 線の端点が移動し、接続先が変更可能                           |
| ドラッグ（選択状態）       | ノード     | 複数選択したノードをドラッグ                                     | 選択されたノードがグループとして移動                         |
| ドラッグ（選択状態）       | 線の端点   | 複数選択した線の端点をドラッグ                                    | 選択された線の端点がグループとして移動                        |
| 右クリック＋ドラッグ       | キャンバス | 右クリック＋ドラッグ                                            | キャンバスがパン移動                                       |
| マウスホイール            | キャンバス | ホイール回転                                                 | キャンバスが縦方向に移動                                    |
| Shift + マウスホイール     | キャンバス | Shift キー＋ホイール回転                                        | キャンバスが横方向に移動                                    |
| トラックパッド二本指スクロール | キャンバス | 二本指スクロール操作                                             | 任意方向へのパン移動                                        |
| BackSpace / Delete     | 選択状態   | ノードまたは線が選択された状態で押下                                | 選択された要素が削除される                                    |

---

この詳細動作仕様書は、yaNote v1.2.9 の各操作と機能について説明しており、ユーザーが直感的に操作できるよう設計されています。  
各機能の操作方法とその結果を把握することで、柔軟かつ効率的に情報を整理・管理できるようになっています。
