# yaNote v1.2.12 詳細動作仕様書

本仕様書は、yaNote の各機能の詳細な動作を記述しています。  
ここに記載される内容は、ノード生成・編集、接続線操作、キャンバス操作、コントロールパネルの各種機能などを対象とし、v1.2.12 の新機能も含みます。  
本仕様書の修正は、必要な箇所のみ更新してください。

---

## 1. 基本要素とキャンバス

### 1.1. 基本要素

- **ノード（情報ブロック）**  
  - ユーザーが作成するテキストブロックです。  
  - **表示モード**:  
    - **standard（標準）**: 白背景、文字色 #404040、枠線あり  
    - **text-only（テキスト専用）**: 背景・枠線・影なし、文字色 #404040  
    - **grey（グレー）**: 背景 #595959、文字色 #FFFFFF、枠線なし  
    - **red（赤）**: 背景 #BF1304、文字色 #FFFFFF、枠線なし  
    - **dotted（点線）**: 背景が薄いグレー (#f0f0f0)、枠線が点線  
  - **新機能：Markdown記法によるリンク変換**  
    - ノード内に `[リンクテキスト](https://example.com)` の形式で記述された場合、編集完了時に自動的に HTML の `<a>` タグに変換されます。  
    - リンクは `target="_blank"` 属性が付与され、新しいタブで開きます。  
    - 改行は `<br>` タグに変換され、テキストレイアウトが保持されます。  
    - 記法に誤りがある場合は変換されず、元の Markdown 表記がそのまま表示されます。
  - **表示レイアウトの改善**  
    - v1.2.12 では、ノードの CSS を `flex-direction: column;` や `align-items: flex-start;` に変更することで、テキストが縦方向に積まれ、改行や左寄せ表示が正しく反映されるようになっています。
  - **初期作成の違い**  
    - **中心ノード**は、アプリ起動時に `firstNodeType`（通常 "standard"） に基づいて生成されます。  
    - **新規ノード**（空白部分のダブルクリックで作成される場合）は、v1.2.12 では既定で **dotted** タイプとなり、後からユーザーが手動で変更可能です。

### 1.2. キャンバス

- キャンバスは、広大な論理座標（例：10000×10000ピクセル）上にすべての要素を配置する領域です。  
- 初期状態では論理座標 (5000, 5000) に「中心ノード」が生成され、その他は空白状態です。  
- キャンバスのパン（移動）やズーム操作により表示領域は変化しますが、各要素の論理座標は保持されます。

---

## 2. コントロールパネル

- **位置**: 画面右上に固定表示され、常に操作可能です。  
- **主要要素**:
  - **タイトルフィールド**: ノート全体のタイトル表示・編集。シングルクリックで編集開始（ダブルクリックから変更）。
  - **ノード操作ボタン**: 太字切替、ノード種類変更（standard, text-only, grey, red, dotted）などを操作可能。  
  - **接続線操作ボタン**: 線種・線の点線／実線切替ボタン。  
  - **新規/開く/保存ボタン**: ノードおよび接続線の状態の初期化、エクスポート／インポート機能。  
- **新機能**:  
  - ノードが選択されている状態で、キーボードの「e」キーを押すと、選択中のノードが編集モードに切り替わります。

---

## 3. ノードの操作

### 3.1. ノードの生成と編集

- **生成**:  
  - キャンバスの空白部分をダブルクリックすると、指定位置に新しいノードが作成されます。  
  - **Ctrl/Cmd+Enter ショートカット**: 現在選択または編集中のノードの直下（約60px下）に、同じ種類の新規ノードを追加します。
- **編集**:  
  - ノードをクリックするか、選択状態で **e** キーを押すことで編集モードに入ります。  
  - 編集中は、元の Markdown 記法で記述された生テキスト（rawText）がプレーンテキストとして表示され、ユーザーが自由に修正可能です。  
  - 編集完了は Enter キーを 2 回押すか、他のノードが選択されることで自動的に確定されます。  
  - 編集終了後、入力内容は Markdownリンク変換処理を経て、正しい Markdown 記法であれば HTML のリンクに変換されます。

### 3.2. ノードの種類と状態

- ユーザーは、コントロールパネルやショートカット操作でノードの種類を切り替えることができます。  
- 新規ノードは、デフォルトで `defaultNodeType`（v1.2.12 では "dotted" が設定）で生成されますが、既存ノードの種類を引き継ぐ場合もあります。

---

## 4. 接続線と分岐作成

- **接続線生成**:  
  キャンバス上でノード同士をドラッグ＆ドロップすることで接続線が生成されます。
- **分岐作成**:  
  ノードからドラッグすることで分岐（子ノード）を作成できます。  
  - 分岐作成時、分岐元ノードの種類に応じた接続線のスタイルが固定されます。  
    - **dotted ノードの場合**: 接続線は点線かつ矢印なしに固定。  
    - **それ以外の場合**: 実線かつ通常の矢印に固定されます。

---

## 5. キーボードショートカット

- **Ctrl/Cmd+Enter**:  
  現在選択または編集中のノードの直下（約60px下）に、同じ種類の新規ノードを追加します。
  
- **e キー**:  
  ノードが選択されている状態で「e」キーを押すと、該当ノードが編集モードに切り替わります。  
  ※ 他のノードが選択された場合、既に編集中のノードは自動的に編集確定となります。

- **Ctrl/Cmd+Z / Ctrl/Cmd+Y**:  
  Undo/Redo 操作が可能です。

- **Backspace / Delete**:  
  選択中のノードを削除します。

---

## 6. 状態管理

- **自動保存**:  
  各操作終了時に、ノード、接続線、キャンバスのパン・ズーム状態がローカルストレージに自動保存されます。

- **エクスポート／インポート**:  
  現在の状態を JSON 形式でエクスポート／インポートでき、ファイル名にはタイトルと日時が付与されます。

- **多タブ同期**:  
  複数タブ間で状態が更新された場合、最新の状態が自動的に同期されます。

---

## 7. まとめ

v1.2.12 では、以下の点が新たに追加または改善されています：

- **Markdown記法によるリンク変換**  
  - ノード内の正確な Markdown形式（`[リンクテキスト](URL)`）の記述が、編集完了時に自動で HTML の `<a>` タグに変換されるようになりました。  
  - 改行も `<br>` タグに置換され、レイアウトが維持されます。

- **「e」キーによる編集モード切替**  
  - 選択中のノードがある場合、キーボードの「e」キーを押すと即座にそのノードが編集モードに入ります。  
  - 他のノードが選択された場合、編集中のノードは自動的に編集確定されます。

- **ノード表示レイアウトの改善**  
  - ノードの CSS に `flex-direction: column;`、`align-items: flex-start;`、`text-align: left;` を追加することで、改行や左寄せ表示が正しく反映されるようになりました。

これにより、ユーザーはより直感的かつ効率的にノードの追加、編集、接続が行えるようになります。

---

この仕様書は、v1.2.11 の既存機能をすべて保持しつつ、v1.2.12 の新機能と改善点を反映しています。変更点の詳細については、各項目をご確認ください。
