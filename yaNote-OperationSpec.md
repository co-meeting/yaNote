# yaNote v1.2.10 詳細動作仕様書

- 本仕様書は、yaNote の動作の詳細について記述しています。  
- ここに記載される内容は、実装されているすべての機能（ノード生成・編集、接続線操作、キャンバス操作、コントロールパネルの各種機能など）を対象とし、v1.2.10 の新機能も含みます。  
- 本仕様書の修正は、必要な箇所のみ更新してください。

---

## 1. 基本要素とキャンバス

### 1.1. 基本要素

- **ノード（情報ブロック）**  
  - ユーザーが作成するテキストブロック。  
  - **5種類の表示モード**：  
    - **standard（標準）**: 白背景、文字色 #404040、枠線あり  
    - **text-only（テキスト専用）**: 背景・枠線・影なし、文字色 #404040  
    - **grey（グレー）**: 背景 #595959、文字色 #FFFFFF、枠線なし  
    - **red（赤）**: 背景 #BF1304、文字色 #FFFFFF、枠線なし  
    - **dotted（点線）**: 背景は薄いグレー（#f0f0f0）、枠線は点線（1px dashed #404040）  
  - ノードは、太字設定が可能で、複数行テキストの入力にも対応します（Shift+Enter で改行）。
  - 新規作成時のデフォルトは通常は **standard** ですが、コントロールパネルから変更可能です。

- **線（接続線・独立線）**  
  - ノード間の関連性を示すために使用されます。  
  - 線種は、**standard（標準矢印）**、**no-arrow（矢印なし）**、**reverse-arrow（逆矢印）**、**both-arrow（両方向矢印）** の4種類から選択できます。  
  - 線の表示は、実線と点線（dash）の切替が可能です。  
  - v1.2.10 では、すべての接続線および矢印マーカーの色が **#404040** に統一されています。

### 1.2. キャンバス

- キャンバスは、広大な論理座標（例：10000×10000ピクセル）上に全要素を配置する領域です。  
- **初期状態**  
  - 論理座標 (5000, 5000) に「中心ノード」が作成され、その他は空白状態です。  
- キャンバスのパン（移動）やズーム操作（v1.2.10 ではズーム機能は現状後回し）により表示領域は変化しますが、各要素の論理座標は保持され、正確な操作が行えます。

---

## 2. コントロールパネル

- **表示位置:**  
  画面右上に固定表示され、常に操作可能です。  
  ※ `position: fixed` により、キャンバスの transform の影響を受けません。

- **主な要素と機能:**

  - **タイトルフィールド**  
    - ノート全体のタイトルを表示・編集します。  
    - **v1.2.10 では、タイトルフィールドはシングルクリックで編集開始します。**  
    - 編集中はテキストが左寄せ、確定後は右寄せになり、入力内容に合わせて自動で幅が調整されます。  
    - 空の場合は「無題」として扱われ、エクスポート時のファイル名に反映されます。

  - **太字ボタン（B）**  
    - 選択中のノードのテキストを太字に切り替えます。  
    - 複数選択時は一括で設定変更可能です。  
    - ノード未選択の場合は無効化されます。

  - **ノード種類変更ボタン（◻︎）**  
    - 現在のノード種類（standard, text-only, grey, red, dotted）を切り替えます。  
    - ボタン自体は、現在のデフォルトノード種類を視覚的に示す色とテキストで表示されます。  
    - 何も選択されていない場合は、新規作成時のデフォルトノード種類が変更されます。

  - **線種変更ボタン（→, —, ←, ↔）**  
    - 選択中の線（またはデフォルト）の線種を、4種類の中からローテーションで切り替えます。

  - **点線／実線切替ボタン（—, ‥）**  
    - 選択中の線の表示スタイルを、実線と点線で切り替えます。  
    - 状態はボタンのシンボルで示され、選択がない場合はデフォルト設定が変更されます。

  - **その他のボタン**  
    - **「新規」**: すべてのノードと線を削除して初期状態に戻す  
    - **「開く」**: 保存済みの JSON ファイルをインポートし、状態を復元する  
    - **「保存」**: 現在の状態を JSON ファイルとしてエクスポートする  
      （ファイル名にはタイトルと日付・時刻が付与されます）

---

## 3. ノードの操作

### 3.1. ノードの生成と編集

- **生成**:  
  キャンバスの空白部分をシングルクリックすると、新規ノードが生成されます。  
  ノード生成直後は編集モードとなり、テキスト入力が可能です。

- **編集**:  
  ノードをクリックすると編集モードに入り、背景が薄黄色に変化します。  
  - **編集終了**: Enter キー（2回押下またはフォーカス外クリック）で確定します。  
  - **改行**: Shift+Enter で改行が挿入され、ノードの高さが自動調整されます。  
  - 空白の場合はノード削除の対象となります。

- **ノード種類の変更と太字設定**:  
  - コントロールパネルの **◻︎** ボタンで、選択中のノードの種類を切り替えます。  
  - **B** ボタンで太字設定を行い、重要な情報を強調できます。

### 3.2. 分岐作成とグループ操作

- **分岐作成**:  
  ノードをクリック後、ドラッグすることで分岐作成が可能です。  
  **v1.2.10 の仕様**: 分岐作成時に生成される新規ノードは、親ノードの種別にかかわらず必ず **text-only** タイプとして作成されます。

- **複数選択とグループ移動**:  
  - Shift+クリックやラバーバンド選択で、複数のノードや線を同時に選択できます。  
  - 選択した要素はグループとして一括で移動が可能です。  
  - さらに、一括で太字やノード種別、線種・線タイプの変更ができます。

---

## 4. 線の操作

### 4.1. 線の生成

- **背景上での生成**:  
  キャンバスの空白部分をシングルクリックし、2回目のクリック時にドラッグすると、開始点から新規線が生成されます。

- **ノード上での生成（ブランチ作成）**:  
  ノードをクリック後、ドラッグすると、そのノードから線が生成されます。  
  ※ 分岐作成の場合は、新規ノードは text-only タイプとして作成されます。

- **接続変更**:  
  線の両端に表示されるハンドルをドラッグすることで、接続先を変更できます。

### 4.2. 線種と線表示スタイルの変更

- **線種の変更**:  
  コントロールパネルの線種変更ボタンをクリックすると、選択中またはデフォルトの線種が「standard」「no-arrow」「reverse-arrow」「both-arrow」の順に切り替わります。

- **線表示スタイルの切替**:  
  コントロールパネルの点線／実線切替ボタンで、線の表示が実線と点線に変更可能です。  
  すべての接続線および矢印マーカーは、v1.2.10 では **#404040** に統一されています。

---

## 5. キャンバス操作

- **パン移動**:  
  - 右クリック＋ドラッグにより、キャンバス全体が移動します。  
  - マウスホイールや Shift+ホイールで縦横移動が可能です。  
  - トラックパッドでは二本指スクロールにより任意方向に移動できます。

- **Undo/Redo**:  
  すべての操作（生成、編集、移動、削除など）は Undo/Redo の対象です。  
  - Undo: Ctrl+Z / Cmd+Z  
  - Redo: Ctrl+Y / Cmd+Y

---

## 6. 状態管理

- **自動保存**:  
  各操作終了時に、ノード、線、各種設定、キャンバスのパン・ズーム状態がローカルストレージに自動保存されます。

- **データのエクスポート／インポート**:  
  - **エクスポート**: 現在の状態を JSON 形式でファイルとして保存します（ファイル名にはタイトルと日付・時刻が付与されます）。  
  - **インポート**: 保存済み JSON ファイルからデータを復元します。  
  - 古いバージョンのデータも自動的にマイグレーションされます。

- **多タブ同期**:  
  複数タブ間で状態が更新された場合、最新状態が自動的に同期されます。

---

この仕様書は、yaNote v1.2.10 の各操作と機能を詳細に説明しています。  
特に、分岐作成時の新規ノードが常に **text-only** になる点、新たな **dotted** ノードタイプの追加、及びタイトルフィールドのシングルクリック編集への変更により、ユーザーはより直感的かつ効率的にアプリを利用できるようになっています。
