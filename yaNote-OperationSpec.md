# yaNote v1.2.11 詳細動作仕様書

本仕様書は、yaNote の各機能の詳細な動作を記述しています。  
ここに記載される内容は、ノード生成・編集、接続線操作、キャンバス操作、コントロールパネルの各種機能などを対象とし、v1.2.11 の新機能も含みます。  
本仕様書の修正は、必要な箇所のみ更新してください。

---

## 1. 基本要素とキャンバス

### 1.1. 基本要素

- **ノード（情報ブロック）**  
  - ユーザーが作成するテキストブロックです。  
  - **5種類の表示モード**：  
    - **standard（標準）**: 白背景、文字色 #404040、枠線あり  
    - **text-only（テキスト専用）**: 背景・枠線・影なし、文字色 #404040  
    - **grey（グレー）**: 背景 #595959、文字色 #FFFFFF、枠線なし  
    - **red（赤）**: 背景 #BF1304、文字色 #FFFFFF、枠線なし  
    - **dotted（点線）**: 背景は薄いグレー (#f0f0f0)、枠線は点線（1px dashed #404040）  
  - ノードは太字設定や複数行入力（Shift+Enter により改行）に対応します。  
  - **初期作成の違い**  
    - **中心ノード**は、アプリ起動時に `firstNodeType`（通常 "standard"） に基づいて生成されます。  
    - **新規ノード**（空白部分のダブルクリックで作成される場合）は、v1.2.11 では既定で **dotted** タイプとなり、その後ユーザーが手動で変更可能です。

- **接続線（線）**  
  - ノード間の関連性を示すために使用します。  
  - 線種は「standard（標準矢印）」「no-arrow（矢印なし）」「reverse-arrow（逆矢印）」「both-arrow（両方向矢印）」の4種類から選択可能です。  
  - 線の表示は実線と点線（dash）の切替が可能で、v1.2.11 では、分岐作成時、分岐元ノードが **dotted** タイプの場合は点線かつ矢印なしに固定され、それ以外は実線かつ通常の矢印に固定されます。  
  - すべての接続線および矢印マーカーの色は **#404040** に統一されています。

### 1.2. キャンバス

- キャンバスは、広大な論理座標（例：10000×10000ピクセル）上に全要素を配置する領域です。  
- 初期状態では論理座標 (5000, 5000) に「中心ノード」が生成され、その他は空白状態です。  
- キャンバスのパン（移動）やズーム操作により表示領域は変化しますが、各要素の論理座標は保持されます。

---

## 2. コントロールパネル

- **位置:** 画面右上に固定表示され、常に操作可能です。  
- **主要要素と機能：**
  - **タイトルフィールド:** ノート全体のタイトル表示・編集（シングルクリックで編集開始、空欄は「無題」として扱う）。
  - **太字ボタン（B）:** 選択中のノードのテキストを太字に切り替えます。
  - **ノード種類変更ボタン（◻︎）:** ノードの種類（standard, text-only, grey, red, dotted）を切替。  
    - 新規作成時は `defaultNodeType`（v1.2.11 では "dotted" が既定）に従います。
  - **線種変更ボタン（→, —, ←, ↔）および点線／実線切替ボタン:** 選択中の接続線の線種・表示スタイルを切り替えます。
  - **新規/開く/保存ボタン:** ノードおよび線の初期化、状態のインポート・エクスポートが可能です。

---

## 3. ノードの操作

### 3.1. ノードの生成と編集

- **生成:**  
  - **空白部分のダブルクリック:** その位置に新規ノードが作成され、既定で **dotted** タイプになります。  
  - **Ctrl/Cmd+Enter ショートカット:**  
    - 現在選択または編集中のノードがある場合、そのノードの直下（約60px下）に、同じ種類の新規ノードが追加されます。  
    - この操作により、下方向に隙間を空けながら連続してノードを追加可能です。
- **編集:**  
  - ノードをクリックすると編集モードに入り、テキスト入力が可能です。  
  - 編集完了は Enter キーを2回押すか、フォーカス外クリックにより確定します。

### 3.2. ノードの種類と状態

- ノードは、コントロールパネルから種類変更が可能です。  
- ノード作成後は、ユーザーによる手動変更が反映され、設定がそのまま保持されます。

---

## 4. 接続線と分岐作成

- **接続線生成:**  
  - キャンバスの空白部分をクリックしてドラッグすることで、ノード間の接続線を生成します。
- **分岐作成:**  
  - ノードからドラッグすることで分岐を作成します。  
  - 分岐作成時、分岐元ノードの種類に応じた接続線のスタイルが固定されます。  
    - **dotted ノードの場合:** 接続線は点線（setDashType("dashed")）かつ矢印なし（setLineType("no-arrow")）に固定。  
    - **それ以外の場合:** 実線（solid）かつ通常の矢印（standard）となります。

---

## 5. キーボードショートカット

v1.2.11 では、従来のショートカットに加え、新たな操作が追加されています。

- **Ctrl/Cmd+Enter (新規ノード追加):**  
  - 現在選択または編集中のノードの直下（約60px下）に、同じ種類の新規ノードを追加します。  
  - 連続操作が可能で、下方向に隙間を空けた形でノードが生成されます。

- **Ctrl/Cmd+Z / Ctrl/Cmd+Y:** Undo/Redo 操作。  
- **Backspace/Delete:** 選択中のノードの削除。

※ Ctrl/Cmd+Enter のショートカットは、編集中でも有効で、現在のノードの状態（nodeType）をそのまま引き継いで新規ノードを生成します。

---

## 6. 状態管理

- **自動保存:**  
  各操作終了時に、ノード、接続線、キャンバスのパン・ズーム状態がローカルストレージに保存されます。
- **エクスポート／インポート:**  
  現在の状態を JSON 形式でファイルとして保存／復元できます。  
  ファイル名にはタイトルと日時が付与されます。
- **多タブ同期:**  
  複数タブ間で状態が更新された場合、最新の状態が自動的に同期されます。

---

## 7. まとめ

v1.2.11 では、以下の点が強化・追加されています：

- **新規ノード追加ショートカット (Ctrl/Cmd+Enter):**  
  - 現在選択・編集中のノードの直下に、同じ種類で新規ノードが追加される機能を実装しました。
  
- **新規ノード作成時のデフォルト:**  
  - 空白部分のダブルクリックによるノード作成では、既定で「dotted」タイプが使用されるようになりました。
  
- **分岐作成時の接続線:**  
  - 分岐元が「dotted」タイプの場合、接続線は点線かつ矢印なし、それ以外の場合は実線かつ通常の矢印に固定されます。

これにより、ユーザーはより直感的かつ効率的にノードの追加、編集、接続が行えるようになりました。